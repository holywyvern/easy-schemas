{"version":3,"sources":["index.js"],"names":[],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;;;AAGA,SAAS,SAAT,CAAkB,GAAlB,EAAuB,SAAvB,EAA6D;AAAA,MAA3B,MAA2B,yDAAlB,EAAkB;AAAA,MAAd,KAAc,yDAAN,IAAM;AAAA;AAAA;AAAA;;AAAA;AAC3D,yBAAgB,OAAO,IAAP,CAAY,SAAZ,CAAhB,8HAAwC;AAAA,UAA/B,GAA+B;;AACtC,UAAI,QAAQ,UAAU,GAAV,CAAZ;AACA,UAAI,WAAW,QAAW,KAAX,SAAoB,GAApB,GAA4B,GAA3C;AACA,UAAI,OAAO,IAAI,GAAJ,CAAP,IAAmB,WAAvB,EAAoC;AAClC,eAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,eAAf,EAAgC,OAAO,QAAvC,EAAZ;AACA;AACD;AACD,oBAAc,IAAI,GAAJ,CAAd,EAAwB,KAAxB,EAA+B,MAA/B,EAAuC,QAAvC;AACD;AAT0D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAU3D,SAAO,MAAP;AACD;;AAED,SAAS,aAAT,CAAuB,GAAvB,EAA4B,SAA5B,EAAuC,MAAvC,EAA+C,KAA/C,EAAsD;AACpD,UAAQ,0BAAQ,SAAR,CAAR;AACE,SAAK,QAAL;AACE,qBAAe,GAAf,EAAoB,SAApB,EAA+B,MAA/B,EAAuC,KAAvC;AACA;AACF,SAAK,UAAL;AACE,uBAAiB,GAAjB,EAAsB,SAAtB,EAAiC,MAAjC,EAAyC,KAAzC;AACA;AACF,SAAK,OAAL;AACE,oBAAc,GAAd,EAAmB,SAAnB,EAA8B,MAA9B,EAAsC,KAAtC;AACF,SAAK,QAAL;AACE,qBAAe,GAAf,EAAoB,SAApB,EAA+B,MAA/B,EAAuC,KAAvC;AACA;AACF,SAAK,QAAL;AACE,gBAAS,GAAT,EAAc,UAAU,UAAxB,EAAoC,MAApC,EAA4C,KAA5C;AACA;AACF;AACE,+CAAsC,KAAtC;AAhBJ;AAmBD;;AAGD,SAAS,cAAT,CAAwB,GAAxB,EAA6B,SAA7B,EAAwC,MAAxC,EAAgD,KAAhD,EAAuD;AACrD,MAAI,QAAQ,IAAZ,EAAkB;AAClB,MAAI,QAAQ,0BAAQ,GAAR,CAAZ;AACA,MAAI,UAAU,SAAd,EAAyB;AACvB,WAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,WAAf,EAA4B,YAA5B,EAAmC,YAAnC,EAA0C,UAAU,SAApD,EAAZ;AACD;AACF;;AAED,SAAS,gBAAT,CAA0B,GAA1B,EAA+B,SAA/B,EAA0C,MAA1C,EAAkD,KAAlD,EAAyD;AACvD,MAAI,QAAQ,IAAZ,EAAkB;AAClB,UAAQ,SAAR;AACE,SAAK,OAAL;AACE,qBAAe,GAAf,EAAoB,SAApB,EAA+B,MAA/B,EAAuC,KAAvC;AACA;AACF,SAAK,MAAL;AACE,qBAAe,GAAf,EAAoB,QAApB,EAA8B,MAA9B,EAAsC,KAAtC;AACA;AACF,SAAK,MAAL;AACE,qBAAe,GAAf,EAAoB,QAApB,EAA8B,MAA9B,EAAsC,KAAtC;AACA;AACF,SAAK,KAAL;AACE,qBAAe,GAAf,EAAoB,OAApB,EAA6B,MAA7B,EAAqC,KAArC;AACA;AACF,SAAK,QAAL;AACE,qBAAe,GAAf,EAAoB,UAApB,EAAgC,MAAhC,EAAwC,KAAxC;AACA;AACF,SAAK,MAAL;AACE,qBAAe,GAAf,EAAoB,QAApB,EAA8B,MAA9B,EAAsC,KAAtC;AACA;AACF,SAAK,IAAL;AACE,qBAAe,GAAf,EAAoB,MAApB,EAA4B,MAA5B,EAAoC,KAApC;AACA;AACF;AACE,UAAI,OAAO,UAAU,OAAO,WAAjB,CAAP,IAAwC,WAA5C,EAAyD;AACvD,uBAAe,GAAf,EAAoB,UAAU,OAAO,WAAjB,CAApB,EAAmD,MAAnD,EAA2D,KAA3D;AACA;AACD,OAHD,MAGO,IAAI,EAAE,eAAe,SAAjB,CAAJ,EAAiC;AACtC,eAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,kBAAf,EAAmC,YAAnC,EAA0C,OAAO,SAAjD,EAAZ;AACD;AACD;AA7BJ;AAgCD;;AAED,SAAS,aAAT,CAAuB,GAAvB,EAA4B,SAA5B,EAAuC,MAAvC,EAA+C,KAA/C,EAAsD;AACpD,MAAI,QAAQ,IAAZ,EAAkB;AAClB,MAAI,QAAQ,0BAAQ,GAAR,CAAZ;AACA,MAAI,SAAS,OAAb,EAAsB;AACpB,QAAI,OAAJ,CAAY,UAAC,KAAD,EAAQ,KAAR;AAAA,aAAkB,cAAc,KAAd,EAAqB,UAAU,CAAV,CAArB,EAAmC,MAAnC,EAA8C,KAA9C,SAAuD,KAAvD,OAAlB;AAAA,KAAZ;AACD,GAFD,MAEO;AACL,WAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,WAAf,EAA4B,YAA5B,EAAmC,YAAnC,EAA0C,UAAU,OAApD,EAAZ;AACD;AACF;;AAED,SAAS,iBAAT,CAA2B,GAA3B,EAAgC;AAC9B,UAAQ,0BAAQ,GAAR,CAAR;AACE,SAAK,QAAL,CAAe,KAAK,OAAL;AAAc,aAAO,IAAI,MAAX;AAC7B,SAAK,MAAL;AAA6B,aAAO,IAAI,OAAJ,EAAP;AAC7B;AAA6B,aAAO,GAAP;AAH/B;AAKD;;AAED,SAAS,cAAT,CAAwB,GAAxB,EAA6B,SAA7B,EAAwC,MAAxC,EAAgD,KAAhD,EAAuD;AACrD,MAAI,OAAO,UAAU,IAAjB,IAAyB,WAA7B,EAA0C;AACxC,kBAAc,GAAd,EAAmB,UAAU,IAA7B,EAAmC,MAAnC,EAA2C,KAA3C;AACD;AACD,MAAK,OAAO,UAAU,QAAjB,KAA8B,WAA/B,IAA+C,UAAU,QAAzD,IAAsE,QAAQ,IAAlF,EAAyF;AACvF,WAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,QAAf,EAAyB,YAAzB,EAAZ;AACD;AACD,MAAI,QAAQ,IAAZ,EAAkB;AAChB,QAAK,OAAO,UAAU,GAAjB,IAAwB,QAAzB,IAAuC,kBAAkB,GAAlB,IAAyB,kBAAkB,UAAU,GAA5B,CAApE,EAAuG;AACrG,aAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,SAAf,EAA0B,YAA1B,EAAiC,KAAK,UAAU,GAAhD,EAAZ;AACD;AACD,QAAK,OAAO,UAAU,GAAjB,IAAwB,QAAzB,IAAuC,kBAAkB,GAAlB,IAAyB,kBAAkB,UAAU,GAA5B,CAApE,EAAuG;AACrG,aAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,QAAf,EAAyB,YAAzB,EAAgC,KAAK,UAAU,GAA/C,EAAZ;AACD;AACD,QAAK,OAAO,UAAU,SAAjB,IAA8B,UAA/B,IAA+C,CAAC,UAAU,SAAV,CAAoB,GAApB,CAApD,EAA+E;AAC7E,aAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,gBAAf,EAAiC,YAAjC,EAAZ;AACD;AACD,QAAK,OAAO,UAAU,OAAjB,KAA6B,WAA9B,IAA8C,CAAC,UAAU,OAAV,CAAkB,IAAlB,CAAuB,GAAvB,CAAnD,EAAgF;AAC9E,aAAO,IAAP,CAAY,EAAE,MAAM,iBAAO,eAAf,EAAgC,YAAhC,EAAZ;AACD;AACF;AACF;;IAGK,M;AAEJ,kBAAY,SAAZ,EAAuB;AAAA;;AACrB,SAAK,UAAL,GAAkB,SAAlB;AACD;;;;6BAEQ,G,EAAK;AACZ,UAAI,SAAS,UAAS,GAAT,EAAc,KAAK,UAAnB,CAAb;AACA,aAAO,EAAE,OAAO,OAAO,MAAP,IAAiB,CAA1B,EAA6B,cAA7B,EAAP;AACD;;SAEA,OAAO,W;4BAAe;AACrB,aAAO,QAAP;AACD;;;wBAEG,S,EAAW;AACb,WAAK,UAAL,GAAkB,sBAAO,KAAP,EAAc,KAAK,UAAnB,EAA+B,SAA/B,CAAlB;AACD;;;;;;AAIH,OAAO,MAAP;;kBAEe,M","file":"index.js","sourcesContent":["import getType from 'type-detect';\r\nimport extend  from 'extend';\r\n\r\nimport Errors  from './errors';\r\n\r\n\r\nfunction validate(obj, validator, errors = [], field = null) {\r\n  for (let key of Object.keys(validator)) {\r\n    let value = validator[key];\r\n    let newField = field ? `${field}.${key}` : key;\r\n    if (typeof obj[key] == 'undefined') {\r\n      errors.push({ type: Errors.UNDEFINED_FIELD, field: newField  });\r\n      continue;\r\n    }\r\n    validateField(obj[key], value, errors, newField);\r\n  }\r\n  return errors;\r\n}\r\n\r\nfunction validateField(obj, validator, errors, field) {\r\n  switch (getType(validator)) {\r\n    case 'string':\r\n      validateString(obj, validator, errors, field);\r\n      break;\r\n    case 'function':\r\n      validateFunction(obj, validator, errors, field);\r\n      break;\r\n    case 'array':\r\n      validateArray(obj, validator, errors, field);\r\n    case 'object':\r\n      validateObject(obj, validator, errors, field);\r\n      break;\r\n    case 'schema':\r\n      validate(obj, validator._validator, errors, field);\r\n      break;\r\n    default:\r\n      throw `Unknown validator for field '${field}'`;\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction validateString(obj, validator, errors, field) {\r\n  if (obj === null) return;\r\n  let given = getType(obj);\r\n  if (given !== validator) {\r\n    errors.push({ type: Errors.NOT_OF_TYPE, field, given, expected: validator })\r\n  }\r\n}\r\n\r\nfunction validateFunction(obj, validator, errors, field) {\r\n  if (obj === null) return;\r\n  switch (validator) {\r\n    case Boolean:\r\n      validateString(obj, 'boolean', errors, field);\r\n      break;  \r\n    case Number:\r\n      validateString(obj, 'number', errors, field);\r\n      break;      \r\n    case String:\r\n      validateString(obj, 'string', errors, field);\r\n      break;        \r\n    case Array:\r\n      validateString(obj, 'array', errors, field);\r\n      break;    \r\n    case Function:\r\n      validateString(obj, 'function', errors, field);\r\n      break;    \r\n    case Symbol:\r\n      validateString(obj, 'symbol', errors, field);\r\n      break;    \r\n    case Date:\r\n      validateString(obj, 'date', errors, field);\r\n      break;\r\n    default:\r\n      if (typeof validator[Symbol.toStringTag] != 'undefined') {\r\n        validateString(obj, validator[Symbol.toStringTag], errors, field);\r\n        break;\r\n      } else if (!(obj instanceof validator)) {\r\n        errors.push({ type: Errors.NOT_AN_INSTANCE_OF, field, class: validator });\r\n      }\r\n      break;\r\n  }\r\n\r\n}\r\n\r\nfunction validateArray(obj, validator, errors, field) {\r\n  if (obj === null) return;\r\n  let given = getType(obj);\r\n  if (given == 'array') {\r\n    obj.forEach((value, index) => validateField(value, validator[0], errors, `${field}[${index}]`));\r\n  } else {\r\n    errors.push({ type: Errors.NOT_OF_TYPE, field, given, expected: 'array' })\r\n  }\r\n}\r\n\r\nfunction numericComparator(obj) {\r\n  switch (getType(obj)) {\r\n    case 'string': case 'array': return obj.length;\r\n    case 'date':                 return obj.getTime();\r\n    default:                     return obj;\r\n  }\r\n}\r\n\r\nfunction validateObject(obj, validator, errors, field) {\r\n  if (typeof validator.type != 'undefined') {\r\n    validateField(obj, validator.type, errors, field);\r\n  }\r\n  if ((typeof validator.required !== 'undefined') && validator.required && (obj === null)) {\r\n    errors.push({ type: Errors.REQUIRED, field });\r\n  }\r\n  if (obj !== null) {\r\n    if ((typeof validator.min == 'number') && (numericComparator(obj) < numericComparator(validator.min))) {\r\n      errors.push({ type: Errors.BELOW_MIN, field, min: validator.min });\r\n    }\r\n    if ((typeof validator.max == 'number') && (numericComparator(obj) > numericComparator(validator.max))) {\r\n      errors.push({ type: Errors.OVER_MAX, field, max: validator.max });\r\n    }\r\n    if ((typeof validator.validator == 'function') && (!validator.validator(obj))) {\r\n      errors.push({ type: Errors.VALIDATOR_FAILED, field });\r\n    }\r\n    if ((typeof validator.pattern !== 'undefined') && !validator.pattern.test(obj)) {\r\n      errors.push({ type: Errors.INVALID_PATTERN, field });\r\n    }\r\n  }\r\n}\r\n\r\n\r\nclass Schema {\r\n\r\n  constructor(validator) {\r\n    this._validator = validator;\r\n  }\r\n\r\n  validate(obj) {\r\n    let errors = validate(obj, this._validator);\r\n    return { valid: errors.length == 0, errors };\r\n  }\r\n\r\n  [Symbol.toStringTag]() {\r\n    return 'schema';\r\n  }\r\n\r\n  add(validator) {\r\n    this._validator = extend(false, this._validator, validator);\r\n  }\r\n\r\n}\r\n\r\nSchema.Errors = Errors;\r\n\r\nexport default Schema;"],"sourceRoot":"/source/"}